<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Form</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
    #districts{
            max-height: 200px; /* Adjust this value as needed */
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
	#branches{
            max-height: 300px; /* Adjust this value as needed */
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
	#degree{
            max-height: 300px; /* Adjust this value as needed */
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        } 
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <form id="dynamic-form" method='post' action="/result">
        <div class="form-group">
            <label for="degree">Course</label>
            <select class="form-control" id="degree" name="degree" required>
                <option value="">Select Course Name</option>
                <!-- Options will be added dynamically -->
            </select>
        </div>
        <div class="form-group">
            <label for="percentile">Percentile</label>
            <input type="text" class="form-control" id="percentile" name="percentile" required>
        </div>
        <div class="form-group">
            <label for="category">Category</label>
            <select class="form-control" id="category" name="category" required>
                <option value="">Select Category</option>
                <!-- Options will be added dynamically -->
            </select>
        </div>
        <div class="form-group" required>
            <label for="branches">Branches</label>
            <div id="branches" name="branches">
                <!-- Checkbox options will be added dynamically -->
            </div>
        </div>
        <div class="form-group">
            <label for="districts">Districts</label>
            <div id="districts" name="districts" required>
                <!-- Checkbox options will be added dynamically -->
            </div>
        </div>
        <button type="submit" id="sub" class="btn btn-primary" value="submit">Submit</button>
    </form>
</div>

<script>
	        
    $(document).ready(function () {
        // Load categories from the server
        $.get('/degree', function (data) {
                var degreeDiv = $('#degree');
                data.forEach(function (degree) {
                    degreeDiv.append(new Option(degree, degree));
                });
            });
            
		$.get('/categoryi', function (data) {
            var categorySelect = $('#category');
            data.forEach(function (category) {
                categorySelect.append(new Option(category, category));
            });
        }).fail(function() {
                console.error('Error loading categories');
            });        
        
        $('#percentile').change(function (){
        	var percentile = $(this).val();
        	$.get('/category',{percentile: percentile}, function (data) {
            var categorySelect = $('#category');
            categorySelect.empty();
            categorySelect.append(new Option('select category'));
            data.forEach(function (category) {
                categorySelect.append(new Option(category, category));
            });
        });    
        });
         
        $('#category').change(function () {
            var selectedCategory = $(this).val();
            var percentile = $('#percentile').val();
            var degree = $('#degree').val();
            
            
            $.get('/branches', {degree: degree, percentile: percentile, category: selectedCategory}, function (data) {
                var branchesDiv = $('#branches');
                branchesDiv.empty();
                data.forEach(function (branch) {
                    branchesDiv.append('<div class="form-check"><input class="form-check-input" type="checkbox" name="branches" value="' + branch + '"><label class="form-check-label">' + branch + '</label></div>');
                });
            });
            
            $.get('/districts', {percentile: percentile, category: selectedCategory, degree: degree}, function (data) {
                var districtsDiv = $('#districts');
                districtsDiv.empty();
                data.forEach(function (district) {
                    districtsDiv.append('<div class="form-check"><input class="form-check-input" type="checkbox" name="districts" value="' + district + '"><label class="form-check-label">' + district + '</label></div>');
                });
            });
            
        });
        
        // Load branches when category changes
        $('#degree').change(function () {
            var selecteddegree = $(this).val();
            var percentile = $('#percentile').val();
            $.get('/category',{percentile: percentile, degree: selecteddegree}, function (data) {
            var categorySelect = $('#category');
            categorySelect.empty();
            data.forEach(function (category) {
                categorySelect.append(new Option(category, category));
            	});
        	});
            $.get('/branches', {percentile: percentile, degree: selecteddegree}, function (data) {
                var branchesDiv = $('#branches');
                branchesDiv.empty();
                data.forEach(function (branch) {
                    branchesDiv.append('<div class="form-check"><input class="form-check-input" type="checkbox" name="branches" value="' + branch + '"><label class="form-check-label">' + branch + '</label></div>');
                });
            });
            
            $.get('/districts', {percentile: percentile, category: selectedCategory, degree: degree}, function (data) {
                var districtsDiv = $('#districts');
                districtsDiv.empty();
                data.forEach(function (district) {
                    districtsDiv.append('<div class="form-check"><input class="form-check-input" type="checkbox" name="districts" value="' + district + '"><label class="form-check-label">' + district + '</label></div>');
                });
            });
            
            
        });

        // Load districts when branches change
        $('#branches').on('change', 'input[type="checkbox"]', function () {
            var selectedBranches = [];
            var percentile = $('#percentile').val();
            var cat = $('#category').val();
            var degree = $('#degree').val();
            $('#branches input:checked').each(function () {
                selectedBranches.push($(this).val());
            });
            $.get('/districts', {branches: selectedBranches, percentile: percentile, category: cat, degree: degree}, function (data) {
                var districtsDiv = $('#districts');
                districtsDiv.empty();
                data.forEach(function (district) {
                    districtsDiv.append('<div class="form-check"><input class="form-check-input" type="checkbox" name="districts" value="' + district + '"><label class="form-check-label">' + district + '</label></div>');
                });
            });
        });
        
        $('#dynamic-form').on('submit', function(event) {
                event.preventDefault();
                let querys = "";
                let formData = {
                    percentile: $('#percentile').val(),
                    category: $('#category').val(),
                    degree: $('#degree').val(),
                    branches: [],
                    districts: []
                };
                querys+= "/result?";
                querys += "percentile=" + $('#percentile').val();
                querys += "&category=" + $('#category').val();
                querys += "&degree=" + $('#degree').val();
                $('input[name="branches"]:checked').each(function() {
                    formData.branches.push($(this).val());
                    querys += "&branches="+$(this).val()
                });
                $('input[name="districts"]:checked').each(function() {
                    formData.districts.push($(this).val());
                    querys += "&districts="+$(this).val()
                });
                //let queryString = $.param(formData);
                $.ajax({
                    type: 'POST',
                    url: '/indextwo',
                    //data: JSON.stringify(formData),
                    contentType: 'application/json',
                    success: function(response) {
                    	window.location.href = querys;
                        //alert('Data submitted: ' + JSON.stringify(response));
                    },
                    error: function(error) {
                        alert('Error: ' +error);
                    }
                });
            });
        
      });
</script>
</body>
</html>

